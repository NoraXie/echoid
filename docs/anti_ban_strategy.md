# EchoID WhatsApp é˜²å°å·é“¾æ¥ç­–ç•¥ (Anti-Ban Link Strategy)

> **åˆ›å»ºæ—¥æœŸ**: 2026-02-12
> **èƒŒæ™¯**: ä¸ºäº†åº”å¯¹ WhatsApp (Meta) ä¸¥è‹›çš„ååƒåœ¾é‚®ä»¶ç®—æ³•ï¼Œé™ä½å›  URL ç‰¹å¾å¯¼è‡´çš„å°å·é£é™©ï¼Œæˆ‘ä»¬å¯¹ Server A çš„é“¾æ¥ç”Ÿæˆç­–ç•¥è¿›è¡Œäº†ç´§æ€¥é‡æ„ã€‚

---

## ğŸš¨ é£é™©èƒŒæ™¯ (The Risk)

åœ¨ WhatsApp çš„é£æ§ä½“ç³»ä¸­ï¼Œ**URLï¼ˆé“¾æ¥ï¼‰** æ˜¯æƒé‡æœ€é«˜çš„å°å·ç‰¹å¾ä¹‹ä¸€ã€‚

*   **é«˜å±ç‰¹å¾**: åŒ…å« `login`, `verify`, `account`, `bank` ç­‰æ•æ„Ÿè¯çš„ URLã€‚
*   **é«˜å±è¡Œä¸º**: ç›´æ¥åœ¨ URL å‚æ•°ä¸­æš´éœ²æ•æ„Ÿä¿¡æ¯ (å¦‚ `?token=LOGIN-123`)ã€‚
*   **é«˜å±åŸŸå**: ä½¿ç”¨å…¬å…±äº‘å‚å•†çš„é»˜è®¤å­åŸŸå (å¦‚ `*.run.app`, `*.herokuapp.com`)ï¼Œå› å…¶å¸¸è¢«æ»¥ç”¨ï¼Œä¿¡èª‰åˆ†æä½ã€‚

ä¸€æ—¦è¢«ç®—æ³•æ ‡è®°ä¸ºâ€œé’“é±¼â€æˆ–â€œåƒåœ¾ä¿¡æ¯â€ï¼Œä¸ä»…å½“å‰è´¦å·ä¼šè¢«å°ç¦ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´æ•´ä¸ªåŸŸåçš„ä¿¡èª‰å´©å¡Œï¼ˆè¿åï¼‰ã€‚

---

## ğŸ›¡ï¸ æ ¸å¿ƒç­–ç•¥ 1ï¼šURL æ··æ·†ä¸çŸ­é“¾ç³»ç»Ÿ (Slug Obfuscation)

æˆ‘ä»¬å°† URL ä»â€œ**æºå¸¦ä¿¡æ¯çš„é•¿é“¾æ¥**â€å˜æ›´ä¸ºâ€œ**æ— æ„ä¹‰çš„éšæœºçŸ­é“¾**â€ã€‚

### âŒ æ”¹é€ å‰ (High Risk)
```
https://echoid-api.run.app/jump?t=LOGIN-123&o=4567
```
*   **é—®é¢˜**: æš´éœ²äº†å‚æ•°ç»“æ„ï¼Œä¸”ä½¿ç”¨äº†ä¸å¯ä¿¡çš„ `run.app` åŸŸåã€‚

### âœ… æ”¹é€ å (Safe)
```
https://yuls.cc/q/x9z8a
```
*   **è‡ªæœ‰åŸŸå**: ä½¿ç”¨ä¿¡èª‰è‰¯å¥½çš„ç‹¬ç«‹åŸŸåã€‚
*   **æ— æ•æ„Ÿè¯**: è·¯å¾„ `/q/` æ— ç‰¹æ®Šå«ä¹‰ï¼Œé¿å¼€å…³é”®è¯æ£€æµ‹ã€‚
*   **éšæœº Slug**: `x9z8a` æ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„ 6 ä½å­—ç¬¦ä¸²ï¼Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡æ•°æ®ã€‚

### ğŸ› ï¸ æŠ€æœ¯å®ç°åŸç†
1.  **ç”Ÿæˆé˜¶æ®µ**: Server ç”Ÿæˆéšæœº Slugï¼Œå°† `{token, otp}` å­˜å…¥ **Redis** (Key: `short:{slug}`, TTL: 5åˆ†é’Ÿ)ã€‚
2.  **å‘é€é˜¶æ®µ**: ä»…å‘é€çŸ­é“¾ç»™ç”¨æˆ·ã€‚
3.  **è·³è½¬é˜¶æ®µ**: ç”¨æˆ·ç‚¹å‡»é“¾æ¥ -> Server æŸ¥è¯¢ Redis -> è·å– Token/OTP -> **302 Redirect** åˆ° `echoid://login` åè®®ã€‚

---

## ğŸ›¡ï¸ æ ¸å¿ƒç­–ç•¥ 2ï¼šåŸŸåè½®è¯¢ (Domain Rotation)

ä¸ºäº†é˜²æ­¢å•ç‚¹æ•…éšœï¼ˆSingle Point of Failureï¼‰ï¼Œæˆ‘ä»¬å¼•å…¥äº†åŸŸåæ± æœºåˆ¶ã€‚

*   **åŸç†**: åœ¨ `.env` ä¸­é…ç½®å¤šä¸ªå¤‡ç”¨åŸŸåã€‚
*   **é€»è¾‘**: æ¯æ¬¡ç”Ÿæˆé“¾æ¥æ—¶ï¼Œéšæœºä»æ± ä¸­é€‰æ‹©ä¸€ä¸ªåŸŸåã€‚
*   **ä¼˜åŠ¿**: å³ä½¿æŸä¸ªåŸŸåè¢« WhatsApp ä¸´æ—¶æ ‡è®°ï¼ˆRed Flagï¼‰ï¼Œå…¶ä»–åŸŸåä»å¯æ­£å¸¸å·¥ä½œï¼Œä¿è¯ä¸šåŠ¡è¿ç»­æ€§ã€‚

**é…ç½®ç¤ºä¾‹ (.env):**
```bash
LINK_DOMAINS=https://yuls.cc,https://verify-fast.top,https://echo-link.net
```

---

## ğŸ›¡ï¸ æ ¸å¿ƒç­–ç•¥ 3ï¼šPrompt è¯­æ°”å¾®è°ƒ (User-First Tone)

åˆ©ç”¨ WhatsApp å¯¹â€œ**å›å¤æ¶ˆæ¯ (Reply)**â€çš„å®½å®¹åº¦ã€‚

*   **åŸç†**: ç›¸æ¯”äºå•†å®¶ä¸»åŠ¨å‘èµ·çš„â€œé€šçŸ¥â€ï¼ŒWhatsApp å¯¹â€œç”¨æˆ·è¯·æ±‚åçš„å›å¤â€é£æ§é˜ˆå€¼æ›´ä½ã€‚
*   **è°ƒæ•´**: åœ¨ LLM Prompt ä¸­å¼ºåˆ¶è¦æ±‚æ–‡æ¡ˆè¯­æ°”åƒæ˜¯åœ¨**ç›´æ¥å›åº”**ç”¨æˆ·çš„è¯·æ±‚ã€‚

**Prompt æŒ‡ä»¤:**
> "Ensure the message sounds like a direct reply to the user's request, not an automated announcement."

**æ–‡æ¡ˆå¯¹æ¯”:**
*   âŒ *ç³»ç»Ÿé€šçŸ¥*: "è¿™æ˜¯æ‚¨çš„éªŒè¯ç  1234ï¼Œè¯·ç‚¹å‡»é“¾æ¥..." (åƒæœºå™¨å¹¿æ’­)
*   âœ… *å›å¤è¯­æ°”*: "æ”¶åˆ°ä½ çš„è¯·æ±‚äº†ï¼è¿™æ˜¯ä½ è¦çš„éªŒè¯ç  1234ï¼Œç‚¹è¿™é‡Œå°±èƒ½è¿›..." (åƒçœŸäººå¯¹è¯)

---

## ğŸ“š è¿ç»´ä¸ç»´æŠ¤

### 1. æ·»åŠ æ–°åŸŸå
åªéœ€åœ¨æœåŠ¡å™¨çš„ `.env` æ–‡ä»¶ä¸­ä¿®æ”¹ `LINK_DOMAINS` å˜é‡ï¼Œé‡å¯ Server å³å¯ç”Ÿæ•ˆã€‚

### 2. æ¸…ç†ç¼“å­˜
å¦‚æœè°ƒæ•´äº†é“¾æ¥ç­–ç•¥ï¼Œæ—§çš„ç¼“å­˜æ–‡æ¡ˆå¯èƒ½å¤±æ•ˆã€‚ä½¿ç”¨ä»¥ä¸‹è„šæœ¬æ¸…ç† Redis å’Œæ•°æ®åº“ä¸­çš„æ—§æ–‡æ¡ˆï¼š

```bash
docker-compose exec server python server/tasks/clear_templates.py
```

### 3. é‡æ–°ç”Ÿæˆæ–‡æ¡ˆ
æ¸…ç†åï¼Œç«‹å³ç”Ÿæˆé€‚é…æ–°ç­–ç•¥çš„å®‰å…¨æ–‡æ¡ˆï¼š

```bash
docker-compose exec server python server/tasks/generate_templates.py
```
